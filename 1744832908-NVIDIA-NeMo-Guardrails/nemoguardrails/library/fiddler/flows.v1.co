define bot refuse to respond
  "I'm sorry, I can't respond to that."

define subflow fiddler user safety
  """
  Use Fiddler's SLMs to detect jailbreaks
  """
  $is_jailbreak = execute call fiddler safety on user message

  if $is_jailbreak
    if $config.enable_rails_exceptions
      create event JailbreakDetectionRailException(message="Jailbreak attempt detected. The user's prompt was identified as an attempted jailbreak. Please ensure your prompt adheres to the guidelines.")
    else
      bot refuse to respond
    abort


define subflow fiddler bot safety
  """
  Use Fiddler's SLMs to detect jailbreaks
  """
  $is_jailbreak = execute call fiddler safety on bot message

  if $is_jailbreak
    if $config.enable_rails_exceptions
      create event JailbreakDetectionRailException(message="Jailbreak attempt detected. The user's prompt was identified as an attempted jailbreak. Please ensure your prompt adheres to the guidelines.")
    else
      bot refuse to respond
    abort

define subflow fiddler bot faithfulness
  """
  Use Fiddler's SLMs to detect hallucinations
  """
  $is_faithful = execute call fiddler faithfulness

  if $is_faithful
    if $config.enable_rails_exceptions
      create event JailbreakDetectionRailException(message="Hallucination Detected. The output was a hallucination.")
    else
      bot refuse to respond
    abort
